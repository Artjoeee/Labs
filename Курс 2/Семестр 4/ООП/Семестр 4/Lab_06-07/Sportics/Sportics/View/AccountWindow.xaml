<Window x:Class="Sportics.View.AccountWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:vm="clr-namespace:Sportics.ViewModel"
        xmlns:local="clr-namespace:Sportics.View"
        mc:Ignorable="d"
        MinHeight="700" MinWidth="500"
        Title="Личный кабинет"
        Height="700" Width="800" WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Window.DataContext>
        <vm:AccountViewModel/>
    </Window.DataContext>

    <Grid Background="{DynamicResource MaterialDesignPaper}" Margin="20">
        <StackPanel VerticalAlignment="Top" HorizontalAlignment="Center" Width="700">
            <TextBlock Text="Личный кабинет" FontSize="24" FontWeight="SemiBold" TextAlignment="Center" Margin="0,10" Foreground="{DynamicResource MaterialDesignBody}"/>
            <TextBlock Text="{Binding UserName}" FontSize="14" FontWeight="SemiBold" TextAlignment="Center" Margin="0,10" Foreground="{DynamicResource MaterialDesignBody}"/>
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,20">
                <Button Content="Выйти" Height="35" Command="{Binding ExitCommand}" Width="80"/>
            </StackPanel>

            <!-- Клиентская часть -->
            <StackPanel Visibility="{Binding IsClient, Converter={StaticResource BoolToVis}}">
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding UserBalance, StringFormat=Баланс: {0:C}}" FontSize="16" FontWeight="SemiBold" Margin="0,10" Foreground="{DynamicResource MaterialDesignBody}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <Button Content="Пополнить баланс" Height="35" Margin="0,15,5,0" Command="{Binding BalanceCommand}" Width="180"/>
                </StackPanel>

                <ScrollViewer>
                    <TabControl Margin="0,20,0,0">
                        <!-- Вкладка с записями на тренировки -->
                        <TabItem Header="Записи на тренировки">
                            <StackPanel>
                                <TextBlock Text="Ваши записи на тренировки:" FontSize="16" FontWeight="Bold" Margin="0,10" Foreground="{DynamicResource MaterialDesignBody}"/>
                                <DataGrid ItemsSource="{Binding UserSchedules}" AutoGenerateColumns="False" CanUserAddRows="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Дата" Binding="{Binding Date, StringFormat=d}" Width="*"/>
                                        <DataGridTextColumn Header="Время" Binding="{Binding Time}" Width="*"/>
                                        <DataGridTextColumn Header="Категория" Binding="{Binding Category}" Width="*"/>
                                        <DataGridTextColumn Header="Тренер" Binding="{Binding Coach.Name}" Width="*"/>
                                        <DataGridTemplateColumn Header="Действия" Width="*">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Button Content="Отменить" 
                                                        Command="{Binding DataContext.CancelScheduleCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        CommandParameter="{Binding}"/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </TabItem>

                        <!-- Вкладка с абонементами -->
                        <TabItem Header="Мои абонементы">
                            <StackPanel>
                                <TextBlock Text="Ваши абонементы:" FontSize="16" FontWeight="Bold" Margin="0,10" Foreground="{DynamicResource MaterialDesignBody}"/>
                                <DataGrid ItemsSource="{Binding UserMemberships}" AutoGenerateColumns="False" CanUserAddRows="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Название" Binding="{Binding Membership.ShortName}" Width="*"/>
                                        <DataGridTextColumn Header="Дата окончания" Binding="{Binding EndDate, StringFormat=d}" Width="*"/>
                                        <DataGridTextColumn Header="Категория" Binding="{Binding Membership.Category}" Width="*"/>
                                        <DataGridTemplateColumn Header="Действия" Width="*">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <Button Content="Отменить" 
                                                        Command="{Binding DataContext.CancelMembershipCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        CommandParameter="{Binding}"/>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </TabItem>
                    </TabControl>
                </ScrollViewer>

            </StackPanel>
        </StackPanel>

    </Grid>
</Window>
